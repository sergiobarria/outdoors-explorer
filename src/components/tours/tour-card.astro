---
import {
	CalendarIcon,
	DollarSignIcon,
	FootprintsIcon,
	HourglassIcon,
	StarIcon,
	UserIcon
} from 'lucide-react';

import type { TourDetail } from '@/db/types';
import { formatCurrency, formatDate } from '@/lib/utils';

interface Props {
	tour: TourDetail;
}

const { tour } = Astro.props as Props;
const rating = tour.ratingsAverage ?? 0;
---

<div class="group flex flex-col overflow-hidden rounded-xl bg-gray-800 text-gray-200">
	<div class="relative h-full overflow-hidden">
		<img
			src={tour.images.at(0) as string}
			alt={tour.name}
			width={600}
			height={400}
			class="h-64 w-full object-cover transition-transform duration-300 group-hover:scale-105"
			transition:name="tour-image"
		/>
		{/* Image gradient */}
		<div
			class="absolute inset-0 bg-gradient-to-tr from-primary via-primary to-lime-500 opacity-50 transition-opacity duration-300 group-hover:opacity-0"
		>
		</div>
		<div
			class="absolute bottom-0 z-20 flex w-full items-center gap-1 bg-black/40 p-2 text-white"
		>
			<StarIcon className="size-4 fill-amber-500" />
			<span class="font-semibold text-white">{rating.toFixed(1)}</span>
			<small>
				({tour.ratingsQty}
				{tour.ratingsQty === 1 ? 'review' : 'reviews'})
			</small>
		</div>
	</div>

	<div class="flex h-full flex-col p-3">
		<div class="mb-4 flex flex-col space-y-2">
			<a href={`/tours/${tour.slug}`} class="underline-offset-2 hover:underline">
				<h3 class="text-xl font-bold">{tour.name}</h3>
			</a>
			<p>{tour.summary}</p>
		</div>

		<div class="mt-auto grid grid-cols-2 gap-3 text-sm">
			<div class="flex items-center space-x-2">
				<CalendarIcon className="size-5 text-primary" />
				<span>{formatDate(tour.startDates?.at(0) || '')}</span>
			</div>
			<div class="flex items-center space-x-2">
				<UserIcon className="size-5 text-primary" />
				<span class="capitalize">{tour.maxGroupSize} people</span>
			</div>
			<div class="flex items-center space-x-2">
				<HourglassIcon className="size-5 text-primary" />
				<span class="capitalize">{tour.duration} days</span>
			</div>
			<div class="flex items-center space-x-2">
				<FootprintsIcon className="size-5 text-primary" />
				<span class="capitalize">{tour.difficulty}</span>
			</div>
		</div>

		<hr class="my-4 border-gray-200" />

		{/* Display the Tour price */}
		<div class="flex items-center justify-between">
			<div class="flex items-center space-x-2">
				<DollarSignIcon className="size-5 text-primary" />
				<span class="text-xl font-bold">
					{formatCurrency(tour.price / 100)}
					<small>/ per person</small>
				</span>
			</div>

			<a
				href={`/tours/${tour.slug}`}
				class="flex items-center rounded-lg bg-primary/90 px-3 py-2 text-white hover:bg-primary/80"
			>
				See Details
			</a>
		</div>
	</div>
</div>
